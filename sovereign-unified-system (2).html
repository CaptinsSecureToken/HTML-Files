<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sovereign Intelligence OS - PCL √ó SLIPS √ó HYPERVERSE √ó HI-DAO</title>
<script src="https://cdn.jsdelivr.net/npm/tweetnacl@1.0.3/nacl-fast.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tweetnacl-util@0.15.1/nacl-util.min.js"></script>
<script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

:root {
    --bg-primary: #0a0a0f;
    --bg-secondary: #121218;
    --bg-tertiary: #1a1a24;
    --bg-hover: #222230;
    --text-primary: #ffffff;
    --text-secondary: #a0a0b0;
    --text-muted: #606070;
    --accent-violet: #8b5cf6;
    --accent-fuchsia: #d946ef;
    --accent-success: #10b981;
    --accent-danger: #ef4444;
    --accent-warning: #f59e0b;
    --accent-blue: #3b82f6;
    --border-subtle: #2a2a38;
    --border-visible: #3a3a48;
    --gradient-primary: linear-gradient(135deg, var(--accent-violet), var(--accent-fuchsia));
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --transition: 150ms cubic-bezier(0.4, 0, 0.2, 1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    overflow: hidden;
}

.app-container {
    display: flex;
    height: 100vh;
}

/* Sidebar */
.sidebar {
    width: 280px;
    background: var(--bg-secondary);
    border-right: 1px solid var(--border-subtle);
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow-y: auto;
}

.sidebar-header {
    padding: 24px 20px;
    border-bottom: 1px solid var(--border-subtle);
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
}

.logo-icon {
    width: 42px;
    height: 42px;
    background: var(--gradient-primary);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: 800;
}

.logo-text {
    font-size: 22px;
    font-weight: 800;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.protocol-badges {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-top: 8px;
}

.protocol-badge {
    background: rgba(139, 92, 246, 0.2);
    border: 1px solid var(--accent-violet);
    padding: 3px 10px;
    border-radius: 6px;
    font-size: 0.65rem;
    font-weight: 600;
    color: var(--accent-violet);
}

.protocol-badge.pcl { border-color: var(--accent-success); color: var(--accent-success); background: rgba(16, 185, 129, 0.2); }
.protocol-badge.slips { border-color: var(--accent-violet); color: var(--accent-violet); }
.protocol-badge.hyperverse { border-color: var(--accent-fuchsia); color: var(--accent-fuchsia); background: rgba(217, 70, 239, 0.2); }
.protocol-badge.hidao { border-color: var(--accent-blue); color: var(--accent-blue); background: rgba(59, 130, 246, 0.2); }

.nav-menu {
    flex: 1;
    padding: 16px 12px;
}

.nav-section {
    margin-bottom: 24px;
}

.nav-section-title {
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    padding: 0 16px 8px;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all var(--transition);
    margin-bottom: 4px;
    color: var(--text-secondary);
    font-weight: 500;
    font-size: 14px;
}

.nav-item:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
}

.nav-item.active {
    background: var(--gradient-primary);
    color: white;
}

.nav-icon {
    width: 18px;
    height: 18px;
}

.user-panel {
    padding: 16px;
    border-top: 1px solid var(--border-subtle);
}

.user-info {
    background: var(--bg-tertiary);
    border-radius: var(--radius-md);
    padding: 16px;
}

.user-identity {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
}

.user-avatar {
    width: 42px;
    height: 42px;
    background: var(--gradient-primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 16px;
}

.user-details h4 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 2px;
}

.user-details p {
    font-size: 11px;
    color: var(--text-muted);
    font-family: monospace;
}

.user-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 12px;
}

.stat-box {
    background: var(--bg-secondary);
    border-radius: var(--radius-sm);
    padding: 8px;
    text-align: center;
}

.stat-value {
    display: block;
    font-size: 16px;
    font-weight: 700;
    color: var(--accent-violet);
}

.stat-label {
    font-size: 9px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.btn-identity {
    width: 100%;
    padding: 10px;
    background: var(--gradient-primary);
    border: none;
    border-radius: var(--radius-sm);
    color: white;
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    margin-top: 12px;
}

/* Main Content */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
}

.content-header {
    background: rgba(18, 18, 24, 0.95);
    border-bottom: 1px solid var(--border-subtle);
    padding: 20px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    backdrop-filter: blur(12px);
}

.header-title {
    font-size: 24px;
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.header-actions {
    display: flex;
    gap: 12px;
}

.btn {
    background: var(--gradient-primary);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all var(--transition);
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.15);
}

.btn-success { background: linear-gradient(135deg, var(--accent-success), #059669); }
.btn-danger { background: linear-gradient(135deg, var(--accent-danger), #dc2626); }
.btn-warning { background: linear-gradient(135deg, var(--accent-warning), #d97706); }

.view {
    display: none;
    flex: 1;
    overflow-y: auto;
    padding: 24px;
}

.view.active {
    display: block;
}

/* Grid Layouts */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.stat-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-md);
    padding: 24px;
    transition: all var(--transition);
}

.stat-card:hover {
    border-color: var(--accent-violet);
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(139, 92, 246, 0.2);
}

.stat-card-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

.stat-card-value {
    font-size: 2.5rem;
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.stat-card-subtitle {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-top: 8px;
}

/* PCL/SLIPS Components */
.pcl-layout {
    display: grid;
    grid-template-columns: 400px 1fr;
    gap: 20px;
    height: calc(100vh - 140px);
}

.pcl-panel {
    background: var(--bg-secondary);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-md);
    padding: 20px;
    overflow-y: auto;
}

.section {
    margin-bottom: 24px;
}

.section-title {
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--accent-violet);
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

input, textarea, select {
    width: 100%;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-sm);
    padding: 12px;
    color: var(--text-primary);
    font-size: 14px;
    font-family: inherit;
    margin-top: 8px;
}

input:focus, textarea:focus, select:focus {
    outline: none;
    border-color: var(--accent-violet);
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
}

textarea {
    resize: vertical;
    min-height: 100px;
}

label {
    display: block;
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-top: 12px;
    margin-bottom: 4px;
    font-weight: 500;
}

/* Video Grid */
.video-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
}

.video-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-md);
    overflow: hidden;
    cursor: pointer;
    transition: all var(--transition);
}

.video-card:hover {
    border-color: var(--accent-violet);
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(139, 92, 246, 0.2);
}

.video-thumbnail {
    width: 100%;
    height: 160px;
    background: var(--bg-tertiary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    color: var(--text-muted);
}

.video-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.video-info {
    padding: 16px;
}

.video-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text-primary);
}

.video-meta {
    display: flex;
    gap: 12px;
    font-size: 12px;
    color: var(--text-muted);
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(8px);
}

.modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: var(--bg-secondary);
    padding: 32px;
    border: 1px solid var(--border-visible);
    border-radius: var(--radius-lg);
    width: 90%;
    max-width: 600px;
    max-height: 85vh;
    overflow-y: auto;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.modal-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--text-primary);
}

.close {
    color: var(--text-muted);
    font-size: 32px;
    font-weight: bold;
    cursor: pointer;
    line-height: 1;
}

.close:hover {
    color: var(--text-primary);
}

/* Badges */
.badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-right: 8px;
}

.badge-verified {
    background: rgba(16, 185, 129, 0.2);
    border: 1px solid var(--accent-success);
    color: var(--accent-success);
}

.badge-slips {
    background: rgba(139, 92, 246, 0.2);
    border: 1px solid var(--accent-violet);
    color: var(--accent-violet);
}

.badge-type {
    background: rgba(59, 130, 246, 0.2);
    border: 1px solid var(--accent-blue);
    color: var(--accent-blue);
}

/* Pulse Types */
.pulse-type {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.pulse-type.FRAME { background: #3b82f6; color: white; }
.pulse-type.FRAME::before { content: "üéØ Question"; }
.pulse-type.CONTEXT { background: #10b981; color: white; }
.pulse-type.CONTEXT::before { content: "üìù Background"; }
.pulse-type.ASSUMPTION { background: #f59e0b; color: white; }
.pulse-type.ASSUMPTION::before { content: "üí≠ Assumption"; }
.pulse-type.INFERENCE { background: #8b5cf6; color: white; }
.pulse-type.INFERENCE::before { content: "üí° Insight"; }
.pulse-type.CHECK { background: #06b6d4; color: white; }
.pulse-type.CHECK::before { content: "‚úì Verification"; }
.pulse-type.CONFLICT { background: #ef4444; color: white; }
.pulse-type.CONFLICT::before { content: "‚ö†Ô∏è Problem"; }
.pulse-type.DECISION { background: #ec4899; color: white; }
.pulse-type.DECISION::before { content: "‚öñÔ∏è Decision"; }
.pulse-type.FINAL { background: #14b8a6; color: white; }
.pulse-type.FINAL::before { content: "üèÅ Summary"; }

/* Cytoscape */
#cy {
    width: 100%;
    height: 100%;
    border-radius: var(--radius-md);
    background: rgba(0, 0, 0, 0.2);
    min-height: 500px;
}

/* Toast */
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
}

.toast {
    background: var(--bg-secondary);
    border: 1px solid var(--border-visible);
    border-radius: var(--radius-sm);
    padding: 12px 20px;
    margin-bottom: 10px;
    min-width: 280px;
    opacity: 1;
    transition: opacity 0.3s;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
}

.toast.success { border-color: var(--accent-success); color: var(--accent-success); }
.toast.error { border-color: var(--accent-danger); color: var(--accent-danger); }
.toast.warning { border-color: var(--accent-warning); color: var(--accent-warning); }
.toast.info { border-color: var(--accent-blue); color: var(--accent-blue); }

.hidden { display: none; }

/* Upload Drop Zone */
.upload-dropzone {
    border: 2px dashed var(--border-visible);
    border-radius: var(--radius-md);
    padding: 40px;
    text-align: center;
    background: rgba(139, 92, 246, 0.05);
    cursor: pointer;
    transition: all var(--transition);
}

.upload-dropzone:hover {
    border-color: var(--accent-violet);
    background: rgba(139, 92, 246, 0.1);
}

.upload-dropzone-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

/* Contribution Items */
.contrib-item {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-md);
    padding: 16px;
    margin-bottom: 12px;
    cursor: pointer;
    transition: all var(--transition);
}

.contrib-item:hover {
    border-color: var(--accent-violet);
    background: rgba(139, 92, 246, 0.05);
}

.contrib-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
}

.contrib-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
}

.contrib-score {
    font-size: 20px;
    font-weight: 700;
    color: var(--accent-success);
}

.contrib-meta {
    font-size: 12px;
    color: var(--text-muted);
}

/* Video Player */
.video-player-container {
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    overflow: hidden;
    margin-bottom: 24px;
}

.video-player {
    width: 100%;
    aspect-ratio: 16/9;
    background: #000;
}

.video-player video {
    width: 100%;
    height: 100%;
}

.video-details {
    padding: 24px;
}

.video-actions {
    display: flex;
    gap: 12px;
    margin-top: 16px;
}

.comments-section {
    background: var(--bg-secondary);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-md);
    padding: 20px;
}

.comment-input {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
}

.comment-input input {
    flex: 1;
    margin: 0;
}

.comment-item {
    background: var(--bg-tertiary);
    border-radius: var(--radius-sm);
    padding: 12px;
    margin-bottom: 12px;
}

.comment-author {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 4px;
}

.comment-text {
    font-size: 14px;
    color: var(--text-secondary);
}

.comment-time {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 4px;
}
</style>
</head>
<body>
<div class="app-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">Œ©</div>
                <div class="logo-text">SovereignOS</div>
            </div>
            <div class="protocol-badges">
                <span class="protocol-badge pcl">PCL</span>
                <span class="protocol-badge slips">SLIPS</span>
                <span class="protocol-badge hyperverse">HYPERVERSE</span>
                <span class="protocol-badge hidao">HI-DAO</span>
            </div>
        </div>
        
        <div class="nav-menu">
            <div class="nav-section">
                <div class="nav-section-title">Core</div>
                <div class="nav-item active" data-view="dashboard">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" data-view="identity">
                    <span class="nav-icon">üîê</span>
                    <span>Identity</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Reasoning (PCL √ó SLIPS)</div>
                <div class="nav-item" data-view="pcl-compose">
                    <span class="nav-icon">‚úçÔ∏è</span>
                    <span>Build Reasoning</span>
                </div>
                <div class="nav-item" data-view="pcl-visualize">
                    <span class="nav-icon">üï∏Ô∏è</span>
                    <span>View Graph</span>
                </div>
                <div class="nav-item" data-view="pcl-protocol">
                    <span class="nav-icon">üìú</span>
                    <span>Protocol Info</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Media (HYPERVERSE)</div>
                <div class="nav-item" data-view="video-feed">
                    <span class="nav-icon">üì∫</span>
                    <span>Video Feed</span>
                </div>
                <div class="nav-item" data-view="video-upload">
                    <span class="nav-icon">üì§</span>
                    <span>Upload</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Intelligence (HI-DAO)</div>
                <div class="nav-item" data-view="hidao-contribute">
                    <span class="nav-icon">üí°</span>
                    <span>Contribute</span>
                </div>
                <div class="nav-item" data-view="hidao-marketplace">
                    <span class="nav-icon">üè™</span>
                    <span>Marketplace</span>
                </div>
                <div class="nav-item" data-view="hidao-evaluations">
                    <span class="nav-icon">‚öñÔ∏è</span>
                    <span>Evaluations</span>
                </div>
            </div>
        </div>
        
        <div class="user-panel">
            <div class="user-info">
                <div id="identity-status">
                    <button class="btn-identity" onclick="showIdentityModal()">üîë Create Identity</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="content-header">
            <h1 class="header-title" id="page-title">Dashboard</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="exportAll()">üì• Export All</button>
                <button class="btn" onclick="showIdentityModal()">‚öø Identity</button>
            </div>
        </div>
        
        <!-- Dashboard View -->
        <div class="view active" id="dashboard-view">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-card-label">Reasoning Chains</div>
                    <div class="stat-card-value" id="stat-traces">0</div>
                    <div class="stat-card-subtitle">Structured thought processes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Reasoning Steps</div>
                    <div class="stat-card-value" id="stat-pulses">0</div>
                    <div class="stat-card-subtitle">Cryptographically signed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Videos</div>
                    <div class="stat-card-value" id="stat-videos">0</div>
                    <div class="stat-card-subtitle">HYPERVERSE content</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">HI Tokens</div>
                    <div class="stat-card-value" id="stat-hi-tokens">0</div>
                    <div class="stat-card-subtitle">Human Intelligence</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Contributions</div>
                    <div class="stat-card-value" id="stat-contributions">0</div>
                    <div class="stat-card-subtitle">HI-DAO submissions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Intelligence</div>
                    <div class="stat-card-value" id="stat-intelligence">0</div>
                    <div class="stat-card-subtitle">Network IQ score</div>
                </div>
            </div>
            
            <div style="background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 24px;">
                <h3 style="color: var(--accent-violet); margin-bottom: 16px;">üåê Sovereign Intelligence Operating System</h3>
                <p style="color: var(--text-secondary); margin-bottom: 16px;">
                    A unified platform combining cryptographically verified reasoning (PCL √ó SLIPS), 
                    decentralized media (HYPERVERSE), and human-intelligence acceleration (HI-DAO).
                </p>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                    <div style="background: rgba(139, 92, 246, 0.1); border: 1px solid var(--accent-violet); border-radius: var(--radius-sm); padding: 16px;">
                        <h4 style="color: var(--accent-violet); margin-bottom: 8px;">‚úì Local-First</h4>
                        <p style="font-size: 0.85rem; color: var(--text-muted);">All data stored locally, no mandatory cloud dependencies</p>
                    </div>
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid var(--accent-success); border-radius: var(--radius-sm); padding: 16px;">
                        <h4 style="color: var(--accent-success); margin-bottom: 8px;">‚úì Cryptographically Proven</h4>
                        <p style="font-size: 0.85rem; color: var(--text-muted);">Ed25519 signatures on every operation</p>
                    </div>
                    <div style="background: rgba(217, 70, 239, 0.1); border: 1px solid var(--accent-fuchsia); border-radius: var(--radius-sm); padding: 16px;">
                        <h4 style="color: var(--accent-fuchsia); margin-bottom: 8px;">‚úì SLIPS Protocol</h4>
                        <p style="font-size: 0.85rem; color: var(--text-muted);">Simple, interoperable, portable records</p>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid var(--accent-blue); border-radius: var(--radius-sm); padding: 16px;">
                        <h4 style="color: var(--accent-blue); margin-bottom: 8px;">‚úì Sovereign Identity</h4>
                        <p style="font-size: 0.85rem; color: var(--text-muted);">DID-based, user-controlled authentication</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Identity View -->
        <div class="view" id="identity-view">
            <div style="max-width: 700px; margin: 0 auto;">
                <h2 style="color: var(--accent-violet); margin-bottom: 24px;">üîê Sovereign Identity Management</h2>
                
                <div id="identity-create-section">
                    <div style="background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 24px; margin-bottom: 20px;">
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">
                            Create a sovereign identity to sign and verify all operations across PCL, HYPERVERSE, and HI-DAO. 
                            Your keys are generated locally using Ed25519 and stored in your browser.
                        </p>
                        <label>Display Name (optional)</label>
                        <input type="text" id="identity-name-input" placeholder="Enter a name or leave blank">
                        <button class="btn" onclick="createIdentity()" style="width: 100%; margin-top: 16px;">
                            üîë Generate Sovereign Identity
                        </button>
                    </div>
                </div>
                
                <div id="identity-info-section" class="hidden">
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid var(--accent-success); border-radius: var(--radius-md); padding: 16px; margin-bottom: 20px;">
                        ‚úì Your sovereign identity is active and signing all operations
                    </div>
                    
                    <div class="section">
                        <h3 class="section-title">DID (Decentralized Identifier)</h3>
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 16px; border-radius: var(--radius-sm); word-break: break-all; font-family: monospace; font-size: 0.85rem;">
                            <span id="identity-did-display"></span>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h3 class="section-title">Public Key (Ed25519)</h3>
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 16px; border-radius: var(--radius-sm); word-break: break-all; font-family: monospace; font-size: 0.85rem;">
                            <span id="identity-pubkey-display"></span>
                        </div>
                    </div>
                    
                    <button class="btn btn-warning" onclick="exportIdentity()" style="width: 100%; margin-top: 16px;">
                        üì• Export Identity (Backup)
                    </button>
                    
                    <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid var(--accent-danger); border-radius: var(--radius-md); padding: 16px; margin-top: 20px; font-size: 0.85rem;">
                        <strong style="color: var(--accent-danger);">‚ö† Security Notice:</strong><br>
                        Your private key is stored locally in browser localStorage. Back it up by exporting your identity. 
                        Never share your private key with anyone.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PCL Compose View -->
        <div class="view" id="pcl-compose-view">
            <div class="pcl-layout">
                <div class="pcl-panel">
                    <div class="section">
                        <h3 class="section-title">Add Reasoning Step</h3>
                        
                        <label>Step Type</label>
                        <select id="pulse-type">
                            <option value="FRAME">üéØ Question - Define the problem or question</option>
                            <option value="CONTEXT">üìù Background - Add relevant context or facts</option>
                            <option value="ASSUMPTION">üí≠ Assumption - State what you're assuming</option>
                            <option value="INFERENCE">üí° Insight - Draw a conclusion or insight</option>
                            <option value="CHECK">‚úì Verification - Check or verify something</option>
                            <option value="CONFLICT">‚ö†Ô∏è Problem - Note an issue or conflict</option>
                            <option value="DECISION">‚öñÔ∏è Decision - Make a choice or decision</option>
                            <option value="FINAL">üèÅ Summary - Final conclusion or summary</option>
                        </select>
                        
                        <label>Content</label>
                        <textarea id="pulse-content" placeholder="Describe this step in your reasoning process..."></textarea>
                        
                        <button class="btn" onclick="createPulse()" style="width: 100%; margin-top: 16px;">
                            üîí Add & Sign Step
                        </button>
                    </div>
                    
                    <div class="section">
                        <h3 class="section-title">Active Reasoning Chain</h3>
                        <div id="current-trace-info">
                            <p style="color: var(--text-muted); font-size: 0.85rem;">
                                No active chain. Start by adding a Question step.
                            </p>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h3 class="section-title">Your Reasoning Chains</h3>
                        <div id="traces-list"></div>
                        <button class="btn btn-secondary" onclick="newTrace()" style="width: 100%; margin-top: 12px;">
                            + New Reasoning Chain
                        </button>
                    </div>
                </div>
                
                <div class="pcl-panel">
                    <h3 class="section-title">Step History</h3>
                    <div id="pulse-history"></div>
                </div>
            </div>
        </div>
        
        <!-- PCL Visualize View -->
        <div class="view" id="pcl-visualize-view">
            <div style="height: calc(100vh - 140px);">
                <div style="background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 20px; height: 100%;">
                    <h3 class="section-title">Reasoning Graph (DAG Visualization)</h3>
                    <div id="cy"></div>
                </div>
            </div>
        </div>
        
        <!-- PCL Protocol View -->
        <div class="view" id="pcl-protocol-view">
            <div style="max-width: 900px; margin: 0 auto;">
                <h2 style="color: var(--accent-violet); margin-bottom: 24px;">üìú Sovereign PCL √ó SLIPS Protocol</h2>
                <div style="background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 24px; margin-bottom: 20px;">
                    <h3 style="color: var(--accent-violet); margin-bottom: 16px;">Protocol Principles</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 8px 0; color: var(--text-secondary);">‚úì <strong>Simple:</strong> Minimal, composable primitives</li>
                        <li style="padding: 8px 0; color: var(--text-secondary);">‚úì <strong>Local-first:</strong> No mandatory network dependencies</li>
                        <li style="padding: 8px 0; color: var(--text-secondary);">‚úì <strong>Interoperable:</strong> Standard formats, portable records</li>
                        <li style="padding: 8px 0; color: var(--text-secondary);">‚úì <strong>Provable:</strong> Cryptographically verifiable at every layer</li>
                        <li style="padding: 8px 0; color: var(--text-secondary);">‚úì <strong>Sovereign:</strong> User-controlled identity and data</li>
                    </ul>
                </div>
                
                <div style="background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 24px;">
                    <h3 style="color: var(--accent-violet); margin-bottom: 16px;">Reasoning Step Types</h3>
                    <div style="display: grid; gap: 16px;">
                        <div style="background: var(--bg-tertiary); padding: 16px; border-radius: var(--radius-sm); border-left: 4px solid #3b82f6;">
                            <h4 style="margin-bottom: 8px;">üéØ Question (FRAME)</h4>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Defines the problem space or question you're exploring. Must be the first step in any reasoning chain.</p>
                        </div>
                        <div style="background: var(--bg-tertiary); padding: 16px; border-radius: var(--radius-sm); border-left: 4px solid #10b981;">
                            <h4 style="margin-bottom: 8px;">üìù Background (CONTEXT)</h4>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Adds relevant context, facts, or information to support your reasoning.</p>
                        </div>
                        <div style="background: var(--bg-tertiary); padding: 16px; border-radius: var(--radius-sm); border-left: 4px solid #f59e0b;">
                            <h4 style="margin-bottom: 8px;">üí≠ Assumption (ASSUMPTION)</h4>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">States explicit assumptions you're making in your reasoning process.</p>
                        </div>
                        <div style="background: var(--bg-tertiary); padding: 16px; border-radius: var(--radius-sm); border-left: 4px solid #8b5cf6;">
                            <h4 style="margin-bottom: 8px;">üí° Insight (INFERENCE)</h4>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Draws conclusions or insights based on prior context, assumptions, or other insights.</p>
                        </div>
                        <div style="background: var(--bg-tertiary); padding: 16px; border-radius: var(--radius-sm); border-left: 4px solid #06b6d4;">
                            <h4 style="margin-bottom: 8px;">‚úì Verification (CHECK)</h4>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Verifies or validates claims, insights, or assumptions.</p>
                        </div>
                        <div style="background: var(--bg-tertiary); padding: 16px; border-radius: var(--radius-sm); border-left: 4px solid #ef4444;">
                            <h4 style="margin-bottom: 8px;">‚ö†Ô∏è Problem (CONFLICT)</h4>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Identifies conflicts, contradictions, or issues in the reasoning.</p>
                        </div>
                        <div style="background: var(--bg-tertiary); padding: 16px; border-radius: var(--radius-sm); border-left: 4px solid #ec4899;">
                            <h4 style="margin-bottom: 8px;">‚öñÔ∏è Decision (DECISION)</h4>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Makes a choice or decision based on the reasoning chain.</p>
                        </div>
                        <div style="background: var(--bg-tertiary); padding: 16px; border-radius: var(--radius-sm); border-left: 4px solid #14b8a6;">
                            <h4 style="margin-bottom: 8px;">üèÅ Summary (FINAL)</h4>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Final conclusion or summary. Locks the reasoning chain - no more steps can be added.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Video Feed View -->
        <div class="view" id="video-feed-view">
            <div id="video-player-section" class="hidden"></div>
            <div class="video-grid" id="video-grid"></div>
        </div>
        
        <!-- Video Upload View -->
        <div class="view" id="video-upload-view">
            <div style="max-width: 700px; margin: 0 auto;">
                <h2 style="color: var(--accent-violet); margin-bottom: 24px;">üì§ Upload Video to HYPERVERSE</h2>
                
                <div class="upload-dropzone" onclick="document.getElementById('video-file-input').click()">
                    <div class="upload-dropzone-icon">üé¨</div>
                    <h3 style="margin-bottom: 8px;">Click to select video</h3>
                    <p style="color: var(--text-muted); font-size: 0.85rem;">MP4, WebM, or OGG (max 500MB)</p>
                </div>
                <input type="file" id="video-file-input" accept="video/*" style="display: none;">
                
                <div id="upload-form" class="hidden" style="background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 24px; margin-top: 20px;">
                    <div id="file-preview" style="margin-bottom: 20px;"></div>
                    
                    <label>Title</label>
                    <input type="text" id="video-title" placeholder="Enter video title">
                    
                    <label>Description</label>
                    <textarea id="video-description" placeholder="Enter video description"></textarea>
                    
                    <label>Type</label>
                    <select id="video-type">
                        <option value="tutorial">Tutorial</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="education">Education</option>
                        <option value="other">Other</option>
                    </select>
                    
                    <button class="btn" onclick="submitVideo()" style="width: 100%; margin-top: 16px;">
                        üöÄ Upload to HYPERVERSE
                    </button>
                </div>
            </div>
        </div>
        
        <!-- HI-DAO Contribute View -->
        <div class="view" id="hidao-contribute-view">
            <div style="max-width: 700px; margin: 0 auto;">
                <h2 style="color: var(--accent-violet); margin-bottom: 24px;">üí° Submit Intelligence Contribution</h2>
                
                <div style="background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 24px;">
                    <label>Title</label>
                    <input type="text" id="contrib-title" placeholder="Contribution title">
                    
                    <label>Description</label>
                    <textarea id="contrib-description" placeholder="Describe your contribution"></textarea>
                    
                    <label>Type</label>
                    <select id="contrib-type">
                        <option value="RESEARCH">Research</option>
                        <option value="ANALYSIS">Analysis</option>
                        <option value="CODE">Code</option>
                        <option value="DATA">Data</option>
                    </select>
                    
                    <label style="display: flex; align-items: center; gap: 8px; margin-top: 16px;">
                        <input type="checkbox" id="enable-loop" style="width: auto; margin: 0;">
                        <span>Enable Autonomous Improvement Loop</span>
                    </label>
                    
                    <button class="btn" onclick="submitContribution()" style="width: 100%; margin-top: 20px;">
                        üöÄ Submit for AI Evaluation
                    </button>
                </div>
                
                <div id="your-contributions" style="margin-top: 24px;"></div>
            </div>
        </div>
        
        <!-- HI-DAO Marketplace View -->
        <div class="view" id="hidao-marketplace-view">
            <h2 style="color: var(--accent-violet); margin-bottom: 24px;">üè™ Intelligence Marketplace</h2>
            <div class="video-grid" id="marketplace-grid"></div>
        </div>
        
        <!-- HI-DAO Evaluations View -->
        <div class="view" id="hidao-evaluations-view">
            <h2 style="color: var(--accent-violet); margin-bottom: 24px;">‚öñÔ∏è AI Evaluations</h2>
            <div id="evaluations-list"></div>
        </div>
    </div>
</div>

<!-- Modals -->
<div id="identity-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">üîê Sovereign Identity</h2>
            <span class="close" onclick="closeIdentityModal()">&times;</span>
        </div>
        <div id="modal-identity-content"></div>
    </div>
</div>

<div id="toast-container" class="toast-container"></div>

<script>
(function() {
'use strict';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SLIPS PROTOCOL CORE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const SLIPS = {
    VERSION: '1.0.0',
    SCHEMA: 'sovereign-os',
    
    CONSTRAINTS: {
        FRAME: { mustBeFirst: true, minDependencies: 0, maxDependencies: 0, friendlyName: 'Question' },
        CONTEXT: { mustBeFirst: false, minDependencies: 0, canDependOn: ['FRAME', 'CONTEXT'], friendlyName: 'Background' },
        ASSUMPTION: { mustBeFirst: false, minDependencies: 0, canDependOn: ['FRAME', 'CONTEXT', 'ASSUMPTION'], friendlyName: 'Assumption' },
        INFERENCE: { mustBeFirst: false, minDependencies: 1, canDependOn: ['CONTEXT', 'ASSUMPTION', 'INFERENCE', 'CHECK'], friendlyName: 'Insight' },
        CHECK: { mustBeFirst: false, minDependencies: 1, canDependOn: ['INFERENCE', 'ASSUMPTION', 'CONTEXT'], friendlyName: 'Verification' },
        CONFLICT: { mustBeFirst: false, minDependencies: 2, canDependOn: ['INFERENCE', 'CHECK', 'ASSUMPTION'], friendlyName: 'Problem' },
        DECISION: { mustBeFirst: false, minDependencies: 1, canDependOn: ['INFERENCE', 'CHECK', 'CONFLICT'], friendlyName: 'Decision' },
        FINAL: { mustBeFirst: false, minDependencies: 1, locksTrace: true, canDependOn: ['DECISION', 'INFERENCE', 'CHECK'], friendlyName: 'Summary' }
    },
    
    validatePulse(pulse, trace) {
        const errors = [];
        const constraint = this.CONSTRAINTS[pulse.type];
        
        if (!constraint) {
            errors.push(`Unknown step type: ${pulse.type}`);
            return { valid: false, errors };
        }
        
        const friendlyName = constraint.friendlyName || pulse.type;
        
        if (constraint.mustBeFirst && trace.pulses.length > 0) {
            errors.push(`${friendlyName} must be the first step in your reasoning`);
        }
        
        if (pulse.type !== 'FRAME' && trace.pulses.length === 0) {
            errors.push('First step must be a Question to frame your reasoning');
        }
        
        if (constraint.minDependencies && pulse.dependsOn.length < constraint.minDependencies) {
            errors.push(`${friendlyName} requires at least ${constraint.minDependencies} previous step`);
        }
        
        if (constraint.maxDependencies !== undefined && pulse.dependsOn.length > constraint.maxDependencies) {
            errors.push(`${friendlyName} cannot depend on other steps`);
        }
        
        if (trace.locked) {
            errors.push('This reasoning chain is locked. A Summary step has already finalized it.');
        }
        
        return { valid: errors.length === 0, errors };
    },
    
    createRecord(obj, type) {
        return {
            slips: {
                version: this.VERSION,
                schema: this.SCHEMA,
                recordType: type
            },
            ...obj
        };
    }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CRYPTOGRAPHIC ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const Crypto = {
    canonicalize(obj) {
        const sorted = {};
        Object.keys(obj).sort().forEach(key => {
            if (key === 'signature' || key === 'canonicalHash') return;
            sorted[key] = obj[key];
        });
        return JSON.stringify(sorted);
    },
    
    hash(canonical) {
        const msgUint8 = nacl.util.decodeUTF8(canonical);
        const hashUint8 = nacl.hash(msgUint8);
        return nacl.util.encodeBase64(hashUint8);
    },
    
    sign(privateKey, canonical) {
        const secretKey = nacl.util.decodeBase64(privateKey);
        const message = nacl.util.decodeUTF8(canonical);
        const signature = nacl.sign.detached(message, secretKey);
        return nacl.util.encodeBase64(signature);
    },
    
    verify(publicKey, canonical, signature) {
        try {
            const pubKey = nacl.util.decodeBase64(publicKey);
            const message = nacl.util.decodeUTF8(canonical);
            const sig = nacl.util.decodeBase64(signature);
            return nacl.sign.detached.verify(message, sig, pubKey);
        } catch (e) {
            return false;
        }
    },
    
    randomHex(len) {
        return Array.from(nacl.randomBytes(len))
            .map(b => b.toString(16).padStart(2, '0'))
            .join('');
    }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// IDENTITY LAYER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const Identity = {
    create(name = 'Anonymous') {
        const keyPair = nacl.sign.keyPair();
        const publicKey = nacl.util.encodeBase64(keyPair.publicKey);
        const privateKey = nacl.util.encodeBase64(keyPair.secretKey);
        const did = `did:sovereign:${Crypto.hash(publicKey).substring(0, 32)}`;
        
        State.identity = {
            did,
            displayName: name,
            publicKey,
            privateKey,
            created: Date.now()
        };
        
        this.save();
        this.updateUI();
        toast('‚úì Sovereign identity created', 'success');
        return State.identity;
    },
    
    save() {
        if (State.identity) {
            localStorage.setItem('sovereign-identity', JSON.stringify(State.identity));
        }
    },
    
    load() {
        const stored = localStorage.getItem('sovereign-identity');
        if (stored) {
            State.identity = JSON.parse(stored);
            this.updateUI();
        }
    },
    
    updateUI() {
        const createSection = document.getElementById('identity-create-section');
        const infoSection = document.getElementById('identity-info-section');
        const statusDiv = document.getElementById('identity-status');
        
        if (State.identity) {
            createSection?.classList.add('hidden');
            infoSection?.classList.remove('hidden');
            
            const didDisplay = document.getElementById('identity-did-display');
            const pubkeyDisplay = document.getElementById('identity-pubkey-display');
            
            if (didDisplay) didDisplay.textContent = State.identity.did;
            if (pubkeyDisplay) pubkeyDisplay.textContent = State.identity.publicKey;
            
            if (statusDiv) {
                statusDiv.innerHTML = `
                    <div class="user-identity">
                        <div class="user-avatar">${State.identity.displayName[0].toUpperCase()}</div>
                        <div class="user-details">
                            <h4>${State.identity.displayName}</h4>
                            <p>${State.identity.did.substring(0, 24)}...</p>
                        </div>
                    </div>
                    <div class="user-stats">
                        <div class="stat-box">
                            <span class="stat-value" id="user-stat-tokens">${State.stats.hiTokens}</span>
                            <span class="stat-label">HI Tokens</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-value" id="user-stat-videos">${State.stats.videos}</span>
                            <span class="stat-label">Videos</span>
                        </div>
                    </div>
                `;
            }
        } else {
            createSection?.classList.remove('hidden');
            infoSection?.classList.add('hidden');
            
            if (statusDiv) {
                statusDiv.innerHTML = '<button class="btn-identity" onclick="showIdentityModal()">üîë Create Identity</button>';
            }
        }
    },
    
    export() {
        if (!State.identity) return toast('‚ö† No identity to export', 'warning');
        
        const blob = new Blob([JSON.stringify(State.identity, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `identity-${State.identity.did.substring(14, 26)}.json`;
        a.click();
        toast('‚úì Identity exported', 'success');
    }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE MANAGEMENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const State = {
    identity: null,
    traces: {},
    currentTraceId: null,
    videos: {},
    contributions: {},
    marketplace: {},
    cy: null,
    stats: {
        traces: 0,
        pulses: 0,
        videos: 0,
        hiTokens: 0,
        ihiTokens: 0,
        contributions: 0,
        intelligence: 100
    }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PCL CORE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const PCL = {
    init() {
        this.loadTraces();
        this.initCytoscape();
        this.updateStats();
    },
    
    loadTraces() {
        const stored = localStorage.getItem('sovereign-traces');
        if (stored) {
            State.traces = JSON.parse(stored);
        }
        const currentId = localStorage.getItem('sovereign-current-trace');
        if (currentId && State.traces[currentId]) {
            State.currentTraceId = currentId;
        }
    },
    
    saveTraces() {
        localStorage.setItem('sovereign-traces', JSON.stringify(State.traces));
        localStorage.setItem('sovereign-current-trace', State.currentTraceId);
    },
    
    createTrace(name) {
        const traceId = `trace_${Date.now()}_${Crypto.randomHex(8)}`;
        State.traces[traceId] = {
            id: traceId,
            name,
            created: Date.now(),
            pulses: [],
            locked: false
        };
        State.currentTraceId = traceId;
        this.saveTraces();
        this.updateStats();
        this.renderTracesList();
        this.renderPulseHistory();
        toast('‚úì New trace created', 'success');
    },
    
    addPulse(traceId, { type, content }) {
        if (!State.identity) {
            toast('‚ö† Create an identity first', 'warning');
            return;
        }
        
        const trace = State.traces[traceId];
        if (!trace) return;
        
        const pulse = {
            id: `pulse_${Date.now()}_${Crypto.randomHex(8)}`,
            traceId,
            type,
            author: State.identity.publicKey,
            timestamp: Date.now(),
            dependsOn: [],
            payload: { content }
        };
        
        const validation = SLIPS.validatePulse(pulse, trace);
        if (!validation.valid) {
            toast(`‚ö† ${validation.errors.join(', ')}`, 'error');
            return;
        }
        
        const canonical = Crypto.canonicalize(pulse);
        pulse.canonicalHash = Crypto.hash(canonical);
        pulse.signature = Crypto.sign(State.identity.privateKey, canonical);
        
        if (!Crypto.verify(pulse.author, canonical, pulse.signature)) {
            toast('‚úó Signature verification failed', 'error');
            return;
        }
        
        trace.pulses.push(pulse);
        
        if (type === 'FINAL') {
            trace.locked = true;
            toast('üîí Reasoning chain finalized with Summary', 'info');
        }
        
        this.saveTraces();
        this.updateStats();
        this.renderPulseHistory();
        
        const friendlyName = SLIPS.CONSTRAINTS[type]?.friendlyName || type;
        toast(`‚úì ${friendlyName} step created & signed`, 'success');
    },
    
    renderTracesList() {
        const list = document.getElementById('traces-list');
        if (!list) return;
        
        const traces = Object.values(State.traces);
        if (traces.length === 0) {
            list.innerHTML = '<p style="color: var(--text-muted); font-size: 0.85rem;">No reasoning chains yet</p>';
            return;
        }
        
        list.innerHTML = traces.map(trace => {
            const isActive = trace.id === State.currentTraceId;
            return `
                <div class="contrib-item ${isActive ? 'active' : ''}" onclick="switchTrace('${trace.id}')">
                    <div style="font-weight: 600;">${trace.name}${trace.locked ? ' üîí' : ''}</div>
                    <div style="font-size: 0.75rem; color: var(--text-muted);">${trace.pulses.length} steps</div>
                </div>
            `;
        }).join('');
    },
    
    renderPulseHistory() {
        const container = document.getElementById('pulse-history');
        if (!container) return;
        
        if (!State.currentTraceId) {
            container.innerHTML = '<p style="color: var(--text-muted);">No active reasoning chain</p>';
            return;
        }
        
        const trace = State.traces[State.currentTraceId];
        if (!trace || trace.pulses.length === 0) {
            container.innerHTML = '<p style="color: var(--text-muted);">No steps yet. Start with a Question step to frame your reasoning.</p>';
            return;
        }
        
        container.innerHTML = trace.pulses.map(pulse => {
            const canonical = Crypto.canonicalize(pulse);
            const hash = Crypto.hash(canonical);
            const isVerified = hash === pulse.canonicalHash && Crypto.verify(pulse.author, canonical, pulse.signature);
            
            return `
                <div style="background: var(--bg-tertiary); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); padding: 16px; margin-bottom: 12px;">
                    <div style="margin-bottom: 8px;">
                        <span class="pulse-type ${pulse.type}"></span>
                        ${isVerified ? '<span class="badge badge-verified">‚úì Verified</span>' : '<span class="badge" style="border-color: var(--accent-danger); color: var(--accent-danger);">‚úó Invalid</span>'}
                        <span class="badge badge-slips">SLIPS</span>
                    </div>
                    <div style="color: var(--text-primary); margin-bottom: 8px;">${pulse.payload.content}</div>
                    <div style="font-size: 0.75rem; color: var(--text-muted);">${new Date(pulse.timestamp).toLocaleString()}</div>
                </div>
            `;
        }).join('');
    },
    
    initCytoscape() {
        const container = document.getElementById('cy');
        if (!container) return;
        
        State.cy = cytoscape({
            container,
            style: [
                {
                    selector: 'node',
                    style: {
                        'background-color': 'data(color)',
                        'label': 'data(label)',
                        'color': '#fff',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'font-size': '10px',
                        'width': 70,
                        'height': 70,
                        'border-width': 3,
                        'border-color': '#10b981',
                        'text-wrap': 'wrap',
                        'text-max-width': '60px'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#8b5cf6',
                        'target-arrow-color': '#8b5cf6',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier'
                    }
                }
            ],
            layout: { name: 'breadthfirst', directed: true, padding: 10 }
        });
    },
    
    renderGraph() {
        if (!State.currentTraceId || !State.cy) return;
        
        const trace = State.traces[State.currentTraceId];
        if (!trace) return;
        
        const elements = [];
        const colors = {
            FRAME: '#3b82f6', CONTEXT: '#10b981', ASSUMPTION: '#f59e0b',
            INFERENCE: '#8b5cf6', CHECK: '#06b6d4', CONFLICT: '#ef4444',
            DECISION: '#ec4899', FINAL: '#14b8a6'
        };
        
        const friendlyNames = {
            FRAME: 'üéØ Question', CONTEXT: 'üìù Background', ASSUMPTION: 'üí≠ Assumption',
            INFERENCE: 'üí° Insight', CHECK: '‚úì Verify', CONFLICT: '‚ö†Ô∏è Problem',
            DECISION: '‚öñÔ∏è Decision', FINAL: 'üèÅ Summary'
        };
        
        trace.pulses.forEach(pulse => {
            elements.push({
                data: {
                    id: pulse.id,
                    label: `${friendlyNames[pulse.type] || pulse.type}\n${pulse.payload.content.substring(0, 20)}...`,
                    color: colors[pulse.type] || '#666'
                }
            });
            
            pulse.dependsOn.forEach(depId => {
                elements.push({
                    data: {
                        id: `${depId}-${pulse.id}`,
                        source: depId,
                        target: pulse.id
                    }
                });
            });
        });
        
        State.cy.elements().remove();
        State.cy.add(elements);
        State.cy.layout({ name: 'breadthfirst', directed: true, padding: 10 }).run();
    },
    
    updateStats() {
        let totalPulses = 0;
        Object.values(State.traces).forEach(trace => {
            totalPulses += trace.pulses.length;
        });
        
        State.stats.traces = Object.keys(State.traces).length;
        State.stats.pulses = totalPulses;
        State.stats.videos = Object.keys(State.videos).length;
        State.stats.contributions = Object.keys(State.contributions).length;
        
        updateDashboard();
    }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HYPERVERSE (VIDEO PLATFORM)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const Hyperverse = {
    uploadVideo({ title, description, type, file }) {
        if (!State.identity) {
            toast('‚ö† Create an identity first', 'warning');
            return;
        }
        
        const videoId = `video_${Date.now()}_${Crypto.randomHex(8)}`;
        const url = URL.createObjectURL(file);
        
        const video = SLIPS.createRecord({
            id: videoId,
            title,
            description,
            type,
            url,
            author: State.identity.publicKey,
            timestamp: Date.now(),
            likes: 0,
            views: 0,
            comments: []
        }, 'hyperverse.video');
        
        State.videos[videoId] = video;
        this.save();
        
        State.stats.hiTokens += 50;
        State.stats.videos++;
        
        toast('‚úì Video uploaded! +50 HI tokens', 'success');
        PCL.updateStats();
        this.renderVideoGrid();
    },
    
    save() {
        localStorage.setItem('sovereign-videos', JSON.stringify(State.videos));
    },
    
    load() {
        const stored = localStorage.getItem('sovereign-videos');
        if (stored) {
            State.videos = JSON.parse(stored);
        }
    },
    
    renderVideoGrid() {
        const grid = document.getElementById('video-grid');
        if (!grid) return;
        
        const videos = Object.values(State.videos);
        if (videos.length === 0) {
            grid.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 40px; grid-column: 1 / -1;">No videos yet. Upload your first video!</p>';
            return;
        }
        
        grid.innerHTML = videos.map(video => `
            <div class="video-card" data-video-id="${video.id}">
                <div class="video-thumbnail">üé¨</div>
                <div class="video-info">
                    <div class="video-title">${video.title}</div>
                    <div class="video-meta">
                        <span>üëÅ ${video.views}</span>
                        <span>‚ù§Ô∏è ${video.likes}</span>
                        <span>üí¨ ${video.comments.length}</span>
                    </div>
                </div>
            </div>
        `).join('');
    }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HI-DAO (INTELLIGENCE ACCELERATOR)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const HIDAO = {
    submitContribution({ title, description, type, enableLoop }) {
        if (!State.identity) {
            toast('‚ö† Create an identity first', 'warning');
            return;
        }
        
        const contribId = `contrib_${Date.now()}_${Crypto.randomHex(8)}`;
        
        const contrib = SLIPS.createRecord({
            id: contribId,
            title,
            description,
            type,
            enableLoop,
            author: State.identity.publicKey,
            timestamp: Date.now(),
            score: 0,
            hiTokens: 0,
            ihiTokens: 0,
            evaluations: []
        }, 'hidao.contribution');
        
        State.contributions[contribId] = contrib;
        this.save();
        
        // Simulate AI evaluation
        setTimeout(() => {
            this.evaluateContribution(contribId);
        }, 1000);
        
        toast('‚úì Contribution submitted for AI evaluation', 'success');
        PCL.updateStats();
    },
    
    evaluateContribution(contribId) {
        const contrib = State.contributions[contribId];
        if (!contrib) return;
        
        // Simulated AI evaluation
        const evaluators = [
            { name: 'GPT-4 Evaluator', score: 75 + Math.floor(Math.random() * 20), reasoning: 'Strong analytical framework' },
            { name: 'Claude Evaluator', score: 70 + Math.floor(Math.random() * 25), reasoning: 'Clear methodology' },
            { name: 'Gemini Evaluator', score: 80 + Math.floor(Math.random() * 15), reasoning: 'Innovative approach' }
        ];
        
        const consensusScore = Math.floor(evaluators.reduce((sum, e) => sum + e.score, 0) / evaluators.length);
        
        contrib.score = consensusScore;
        contrib.hiTokens = Math.floor(consensusScore * 1.5);
        contrib.ihiTokens = Math.floor(consensusScore * 0.5);
        contrib.evaluations = evaluators;
        
        State.stats.hiTokens += contrib.hiTokens;
        State.stats.ihiTokens += contrib.ihiTokens;
        State.stats.intelligence += Math.floor(consensusScore / 10);
        
        this.save();
        PCL.updateStats();
        
        toast(`‚úì Evaluation complete! +${contrib.hiTokens} HI tokens`, 'success');
    },
    
    save() {
        localStorage.setItem('sovereign-contributions', JSON.stringify(State.contributions));
    },
    
    load() {
        const stored = localStorage.getItem('sovereign-contributions');
        if (stored) {
            State.contributions = JSON.parse(stored);
        }
    },
    
    renderContributions() {
        const container = document.getElementById('your-contributions');
        if (!container) return;
        
        const contribs = Object.values(State.contributions);
        if (contribs.length === 0) {
            container.innerHTML = '';
            return;
        }
        
        container.innerHTML = `
            <h3 style="color: var(--accent-violet); margin-bottom: 16px;">Your Contributions</h3>
            ${contribs.map(c => `
                <div class="contrib-item">
                    <div class="contrib-header">
                        <div>
                            <div class="contrib-title">${c.title}</div>
                            <span class="badge badge-type">${c.type}</span>
                        </div>
                        <div class="contrib-score">${c.score}/100</div>
                    </div>
                    <div class="contrib-meta">
                        ${c.hiTokens} HI ‚Ä¢ ${c.ihiTokens} iHI ‚Ä¢ ${new Date(c.timestamp).toLocaleDateString()}
                    </div>
                </div>
            `).join('')}
        `;
    }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function toast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
    }, 4000);
}

function updateDashboard() {
    document.getElementById('stat-traces').textContent = State.stats.traces;
    document.getElementById('stat-pulses').textContent = State.stats.pulses;
    document.getElementById('stat-videos').textContent = State.stats.videos;
    document.getElementById('stat-hi-tokens').textContent = State.stats.hiTokens;
    document.getElementById('stat-contributions').textContent = State.stats.contributions;
    document.getElementById('stat-intelligence').textContent = State.stats.intelligence;
    
    const userTokens = document.getElementById('user-stat-tokens');
    const userVideos = document.getElementById('user-stat-videos');
    if (userTokens) userTokens.textContent = State.stats.hiTokens;
    if (userVideos) userVideos.textContent = State.stats.videos;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GLOBAL FUNCTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

window.createIdentity = function() {
    const name = document.getElementById('identity-name-input')?.value.trim() || 'Anonymous';
    Identity.create(name);
    closeIdentityModal();
};

window.exportIdentity = function() {
    Identity.export();
};

window.showIdentityModal = function() {
    document.getElementById('identity-modal').classList.add('active');
};

window.closeIdentityModal = function() {
    document.getElementById('identity-modal').classList.remove('active');
};

window.newTrace = function() {
    const name = prompt('Enter a name for this reasoning chain:');
    if (name) PCL.createTrace(name);
};

window.createPulse = function() {
    if (!State.currentTraceId) {
        toast('‚ö† Create a reasoning chain first', 'warning');
        return;
    }
    
    const type = document.getElementById('pulse-type')?.value;
    const content = document.getElementById('pulse-content')?.value.trim();
    
    if (!content) {
        toast('‚ö† Please describe this reasoning step', 'warning');
        return;
    }
    
    PCL.addPulse(State.currentTraceId, { type, content });
    document.getElementById('pulse-content').value = '';
};

window.switchTrace = function(traceId) {
    State.currentTraceId = traceId;
    PCL.renderTracesList();
    PCL.renderPulseHistory();
    PCL.renderGraph();
};

window.submitVideo = function() {
    const file = document.getElementById('video-file-input')?.files[0];
    const title = document.getElementById('video-title')?.value.trim();
    const description = document.getElementById('video-description')?.value.trim();
    const type = document.getElementById('video-type')?.value;
    
    if (!file || !title) {
        toast('‚ö† File and title required', 'warning');
        return;
    }
    
    Hyperverse.uploadVideo({ title, description, type, file });
    
    document.getElementById('video-title').value = '';
    document.getElementById('video-description').value = '';
    document.getElementById('upload-form').classList.add('hidden');
    document.getElementById('video-file-input').value = '';
};

window.submitContribution = function() {
    const title = document.getElementById('contrib-title')?.value.trim();
    const description = document.getElementById('contrib-description')?.value.trim();
    const type = document.getElementById('contrib-type')?.value;
    const enableLoop = document.getElementById('enable-loop')?.checked;
    
    if (!title || !description) {
        toast('‚ö† Title and description required', 'warning');
        return;
    }
    
    HIDAO.submitContribution({ title, description, type, enableLoop });
    
    document.getElementById('contrib-title').value = '';
    document.getElementById('contrib-description').value = '';
    HIDAO.renderContributions();
};

window.exportAll = function() {
    const data = SLIPS.createRecord({
        identity: State.identity,
        traces: State.traces,
        videos: State.videos,
        contributions: State.contributions,
        stats: State.stats,
        exported: Date.now()
    }, 'sovereign-os.export');
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `sovereign-os-export-${Date.now()}.json`;
    a.click();
    toast('‚úì Complete system exported', 'success');
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EVENT LISTENERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

document.addEventListener('click', (e) => {
    const navItem = e.target.closest('.nav-item');
    if (!navItem || !navItem.dataset.view) return;
    
    const view = navItem.dataset.view;
    
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
    
    navItem.classList.add('active');
    document.getElementById(`${view}-view`)?.classList.add('active');
    
    const titles = {
        'dashboard': 'Dashboard',
        'identity': 'Sovereign Identity',
        'pcl-compose': 'Build Your Reasoning',
        'pcl-visualize': 'Reasoning Graph',
        'pcl-protocol': 'Protocol Specification',
        'video-feed': 'Video Feed',
        'video-upload': 'Upload Video',
        'hidao-contribute': 'Submit Contribution',
        'hidao-marketplace': 'Intelligence Marketplace',
        'hidao-evaluations': 'AI Evaluations'
    };
    
    document.getElementById('page-title').textContent = titles[view] || 'Sovereign OS';
    
    if (view === 'pcl-visualize') {
        setTimeout(() => PCL.renderGraph(), 100);
    }
    if (view === 'video-feed') {
        Hyperverse.renderVideoGrid();
    }
    if (view === 'hidao-contribute') {
        HIDAO.renderContributions();
    }
});

document.getElementById('video-file-input')?.addEventListener('change', (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    
    const preview = document.getElementById('file-preview');
    if (preview) {
        preview.innerHTML = `
            <div style="background: var(--bg-tertiary); border-radius: var(--radius-sm); padding: 12px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 24px;">üé¨</span>
                <div>
                    <div style="font-weight: 600;">${file.name}</div>
                    <div style="font-size: 0.85rem; color: var(--text-muted);">${(file.size / 1024 / 1024).toFixed(2)} MB</div>
                </div>
            </div>
        `;
    }
    
    document.getElementById('upload-form')?.classList.remove('hidden');
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INITIALIZATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function init() {
    console.log('üåê Sovereign Intelligence OS v1.0');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.log('PCL √ó SLIPS √ó HYPERVERSE √ó HI-DAO');
    console.log('Unified cryptographic reasoning, media, and intelligence platform');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    
    Identity.load();
    PCL.init();
    Hyperverse.load();
    HIDAO.load();
    
    updateDashboard();
    PCL.renderTracesList();
    
    console.log('‚úì System initialized');
    console.log(`Identity: ${State.identity ? State.identity.did : 'Not created'}`);
    console.log(`Stats: ${State.stats.traces} reasoning chains, ${State.stats.pulses} steps, ${State.stats.videos} videos`);
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}

})();
</script>
</body>
</html>
